<?php


/**
 * Unit tests for RESTServer class.
 */
class ServicesRESTServerTests extends DrupalUnitTestCase {

  /**
   * Implementation of getInfo().
   */
  public static function getInfo() {
    return array(
      'name' => t('RESTServer unit tests'),
      'description' => t('Test separate methods of class.'),
      'group' => t('Services'),
    );
  }

  public function setUp() {
    parent::setUp();

    module_load_include('inc', 'rest_server', 'includes/RESTServer');
    module_load_include('inc', 'rest_server', 'includes/ServicesContentTypeNegotiator');
    module_load_include('inc', 'rest_server', 'includes/ServicesContext');
    module_load_include('inc', 'rest_server', 'includes/ServicesParser');
    module_load_include('inc', 'rest_server', 'includes/ServicesRESTServerFactory');
    module_load_include('inc', 'rest_server', 'tests/rest_server_mock_classes');
  }

  /**
   * Test method getResourceName().
   */
  public function testGetResourceName() {
    $endpoint_path = 'rest';
    $context_data = array(
      'get' => array('q' => 'rest/node/1.php'),
      'server' => array(),
      'post' => array(),
      'request_body' => '',
    );

    $rest_server_factory = new MockServicesRESTServerFactory(array('context_data' => $context_data));
    $rest_server = $rest_server_factory->getRESTServer($endpoint_path);

    $resource_name = $rest_server->getResourceName();
    $this->assertEqual($resource_name, 'node', 'Retrieve call resource name determined properly.');


    $context_data['get']['q'] = 'rest/user';
    $rest_server_factory = new MockServicesRESTServerFactory(array('context_data' => $context_data));
    $rest_server = $rest_server_factory->getRESTServer($endpoint_path);

    $resource_name = $rest_server->getResourceName();
    $this->assertEqual($resource_name, 'user', 'Index call resource name determined properly.');
  }
}
